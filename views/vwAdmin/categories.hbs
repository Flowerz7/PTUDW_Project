<div class="table-container">
    <h1>Categories management</h1>
		<table class="table2">
      <a href="/admin/categories/add" class="add btn-sm btn btn-primary add-category-btn">Add category</a>
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">Name</th>
          <th class="handle" scope="col">Handle</th>
        </tr>
      </thead>
      <tbody>
        {{#each categories}}
          <tr>
            <td scope="row">{{inc @index}}</td>
            <td>{{name}}</td>
            <td class="handle">
              <a href="/admin/category/{{name}}" class="btn btn-sm btn-primary detail-btn">Detail</a>
              <button class="btn btn-sm btn-primary view-btn">View Subcategory</button>
              <a href='/admin/categories/update?name={{name}}' class="btn btn-sm btn-primary">Update</a>
              <a href="{{name}}" class="btn btn-sm btn-danger delete-category-btn">Delete</a>

              <div class="subCategories-section" style="display: none;">
                  <table class="table2">
                    <thead>
                      <tr>
                        <th scope="col">#</th>
                        <th scope="col">Name</th>
                        <th scope="col">Handle</th>
                      </tr>
                    </thead>

                    <tbody>
                      {{#each subCategories}}
                        <tr>
                          <th scope="row">{{inc @index}}</th>
                          <td>{{name}}</td>
                          <td class="handle">
                            <a href="javascript:void(0)" class="btn btn-sm btn-primary detail-btn">Detail</a>
                            <div class="detail-section" style="display: none;">
                                  <h4><b>{{name}}</b></h4>
                                  <div><strong>Detail:</strong> {{detail}}</div>
                                  <div><strong>Subscribe:</strong> {{subscribe}}</div>
                                  <div><strong>Number of Course:</strong> {{numOfCourses}}</div>
                            </div>
                            <a href='/admin/subCategories/update?name={{name}}' class="btn btn-sm btn-primary">Update</a>

                            {{#unless numOfCourses}}
                              <a href='{{name}}' class="btn btn-sm btn-danger delete-subcategory-btn">Delete</a>
                            {{/unless}}
                          </td>
                        </tr>
                      {{/each}}
                    </tbody>
                  </table>

                  <a href="/admin/subCategories/add" class="btn-sm btn btn-primary add-subcategory-btn">Add subcategory</a>
              </div>

              <div class="card detail-section" style="display: none;">
                  <h4><b>{{name}}</b></h4>
                  <div><strong>Detail:</strong> {{detail}}</div>
                  <div><strong>Subscribe:</strong> {{subscribe}}</div>
              </div>
            </td>
          </tr>
        {{/each}}
      </tbody>
    </table>
</div>

{{#section 'scripts'}}
  <script>
    $(document).ready(() => {
      //#region UI cripts
      var isSubcategorySectionVisible = false
      $('.view-btn').click((e) => {
        e.preventDefault()
        if (isSubcategorySectionVisible == false){
          $(e.target).siblings('.subCategories-section').css('display', 'block')
        }
        else{
          $(e.target).siblings('.subCategories-section').css('display', 'none')
        }

        isSubcategorySectionVisible = !isSubcategorySectionVisible
      })

      var isDetailSectionVisible = false
      $('.detail-btn').click((e) => {
        e.preventDefault()
        if (isDetailSectionVisible == false){
          $(e.target).siblings('.detail-section').css('display', 'block')
        }
        else{
          $(e.target).siblings('.detail-section').css('display', 'none')
        }

        isDetailSectionVisible = !isDetailSectionVisible
      })
      //#endregion

      //#region AJAX calls
      $('.delete-subcategory-btn').click((e) => {
        e.preventDefault()
        const subcateName = $(e.target).attr('href')
        $.post('/admin/subCategories/delete', {name : subcateName})
        window.location = window.location.href
      })

      $('.delete-category-btn').click((e) => {
        e.preventDefault()
        const cateName = $(e.target).attr('href')
        $.post('/admin/categories/delete', {name : cateName}, ({isSuccess}) => {
          if (isSuccess === true){
            window.location = window.location.href
          }
          else {
            alert('failed')
          }
        })
      })
      //#endregion
    })
  </script>
{{/section}}
